<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Access Log</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #121212;
            color: #fff;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: auto;
            background: #1e1e1e;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.05);
        }

        label {
            display: block;
            margin-top: 15px;
            font-weight: bold;
        }

        input, select {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            background: #2c2c2c;
            color: #fff;
            border: 1px solid #444;
            border-radius: 5px;
        }

        button {
            margin-top: 20px;
            padding: 10px;
            background-color: #fff;
            color: #121212;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        button:hover {
            background-color: #ccc;
        }

        .message {
            margin-top: 15px;
            text-align: center;
        }

        .log-results {
            margin-top: 30px;
            background: #222;
            padding: 15px;
            border-radius: 8px;
        }

        .log-entry {
            border-bottom: 1px solid #444;
            padding: 8px 0;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>Log Data Access</h2>
    <form id="accessLogForm">
        <label for="userId">User ID:</label>
        <input type="text" id="userId" name="userId" required>

        <label for="action">Action:</label>
        <input type="text" id="action" name="action" required>

        <label for="dataResource">Data Resource:</label>
        <input type="text" id="dataResource" name="dataResource" required>

        <label for="sensitivityLevel">Sensitivity Level:</label>
        <select id="sensitivityLevel" name="sensitivityLevel" required>
            <option value="CONFIDENTIAL">Confidential</option>
            <option value="RESTRICTED">Restricted</option>
            <option value="INTERNAL">Internal</option>
            <option value="PUBLIC">Public</option>
        </select>

        <button type="submit">Log Access</button>
        <div class="message" id="accessMessage"></div>
    </form>

    <h2 style="margin-top:40px;">Search Logs</h2>
    <form id="searchForm">
        <label for="searchUserId">User ID:</label>
        <input type="text" id="searchUserId">

        <label for="searchAction">Action:</label>
        <input type="text" id="searchAction">

        <button type="submit">Search</button>
    </form>

    <div class="log-results" id="logResults"></div>
</div>

<script>
    document.getElementById('accessLogForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const accessData = {
            userId: document.getElementById('userId').value,
            action: document.getElementById('action').value,
            dataResource: document.getElementById('dataResource').value,
            sensitivityLevel: document.getElementById('sensitivityLevel').value
        };

        const res = await fetch('/api/data/access', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(accessData)
        });

        const messageEl = document.getElementById('accessMessage');
        if (res.ok) {
            messageEl.textContent = 'Access log recorded!';
            messageEl.style.color = 'lightgreen';
            document.getElementById('accessLogForm').reset();
        } else {
            const text = await res.text();
            messageEl.textContent = 'Error: ' + text;
            messageEl.style.color = 'red';
        }
    });

    document.getElementById('searchForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const userId = document.getElementById('searchUserId').value;
        const action = document.getElementById('searchAction').value;

        const query = new URLSearchParams();
        if (userId) query.append('userId', userId);
        if (action) query.append('action', action);

        const res = await fetch(`/api/data/access/search?${query.toString()}`);
        const logs = await res.json();

        const resultDiv = document.getElementById('logResults');
        resultDiv.innerHTML = `<h3>Results (${logs.length} entries)</h3>`;
        logs.forEach(log => {
            resultDiv.innerHTML += `
        <div class="log-entry">
          <strong>User:</strong> ${log.userId} |
          <strong>Action:</strong> ${log.action} |
          <strong>Resource:</strong> ${log.dataResource} |
          <strong>Sensitivity:</strong> ${log.sensitivityLevel}
        </div>`;
        });
    });
</script>

</body>
</html>
